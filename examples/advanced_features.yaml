model:
  name: Advanced Features Demo
  description: Demonstrates delays, lookup tables, and stochastic elements

  time:
    start: 0
    stop: 100
    dt: 0.25
    units: day

  parameters:
    - name: growth_rate
      value: 0.05
      units: 1/day
      description: Natural growth rate

    - name: delay_time
      value: 10.0
      units: day
      description: Delay for perception

    - name: noise_level
      value: 0.1
      units: dimensionless
      description: Noise intensity

  stocks:
    - name: population
      initial: 1000
      inflows: [births]
      outflows: [deaths]
      units: people
      non_negative: true
      description: Total population

    - name: perceived_population
      initial: 1000
      inflows: [perception_adjustment]
      units: people
      description: Delayed perception of population

  flows:
    - name: births
      equation: population * growth_rate * (1 + NORMAL(0, noise_level))
      units: people/day
      description: Birth rate with random variation

    - name: deaths
      equation: population * 0.03 * WITH_LOOKUP(TIME, 0,1.0, 50,1.2, 100,1.5)
      units: people/day
      description: Death rate with time-varying lookup

    - name: perception_adjustment
      equation: (DELAY1(population, delay_time) - perceived_population) / 5
      units: people/day
      description: Adjustment using first-order delay

  auxiliaries:
    - name: growth_factor
      equation: births - deaths
      units: people/day
      description: Net growth

    - name: random_shock
      equation: IF RANDOM() > 0.99 THEN population * 0.1 ELSE 0
      units: people
      description: Random shock events (1% chance per step)

    - name: smoothed_growth
      equation: SMOOTH(growth_factor, 20)
      units: people/day
      description: Smoothed growth using exponential delay

    - name: capacity_factor
      equation: WITH_LOOKUP(population, 0,1.0, 5000,0.5, 10000,0.1)
      units: dimensionless
      description: Capacity constraint via lookup table
